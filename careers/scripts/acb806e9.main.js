String.prototype.startsWith||(String.prototype.startsWith=function(a,b){return b=b||0,this.lastIndexOf(a,b)===b}),function(){function a(){return $("#chkOnlyRemote").is(":checked")}function b(a){return-1!=a.title.indexOf("(allows remote)")}function c(a){return function(b){b in a||(a[b]=0),a[b]++}}function d(a){var b=window.db.transaction([l.OS_OFFERS,l.OS_CATEGORIES],"readwrite"),d=b.objectStore(l.OS_OFFERS),e=b.objectStore(l.OS_CATEGORIES);a.forEach(function(a){d.add(a),a.categories.forEach(function(b){e.add({category:b,offer_id:a.id}),c(k.jobsPerCategory)(b)}),k.allJobsPerId[a.id]=a})}function e(a,b,c,d){return new RSVP.Promise(function(e,f){function g(a,b){var c={cls:""},d=b+1;return c.page=d,1==d&&(c.cls="active"),c}var l="",m={};b.forEach(function(a){m[a]=1}),a.forEach(function(a){var b=a.tag in m;if(b||a.tag.startsWith(c)){var d="";b&&(d=" btn-success"),l+=Mustache.render(h,{extraClass:d,tag:a.tag,count:a.cnt})}});var n=_.chunk(d,15),o=Mustache.render(i,{offers:n[0]}),p="";n.length>1&&(p=Mustache.render(j,{pages:_.map(n,g)})),k.chunks=n,e({tags:l,offers:o,pagination:p})})}function f(a,b,c){return new RSVP.Promise(function(c,d){c(u(a,b))}).then(function(b){return e(b.sortedTags,a,c,b.offers)}).then(function(a){$("#picker-include").html(a.tags),$("#offers").html(a.offers),$("#pagination").html(a.pagination)})}function g(){f(k.filtered,[],$("#txt-search").val())}window.indexedDB=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB;var h='<button data-tag="{{tag}}" class="btn btn-xs btn-default btn-filter{{extraClass}}" href="#"><strong>{{tag}}</strong>({{count}})</span></button>',i='{{#offers}}<a href="{{link}}" target="_blank">{{title}}</a><br>{{/offers}}<br>',j='<nav><ul class="pagination">{{#pages}}<li class="{{cls}}"><a data-page="{{page}}" href="#">{{page}}</a></li>{{/pages}}</ul></nav>',k={jobsPerCategory:{},allJobsPerId:{},filtered:[]},l={DB_NAME:"careers",OS_OFFERS:"offers",OS_CATEGORIES:"categories",IDX_CATEGORY:"category"},m=new RSVP.Promise(function(a,b){var c=indexedDB.deleteDatabase(l.DB_NAME);c.onsuccess=function(b){a()}}),n=new RSVP.Promise(function(a,b){var c=indexedDB.open(l.DB_NAME,1);c.onerror=function(a){b(this)},c.onupgradeneeded=function(a){var b=a.target.result,c=(b.createObjectStore(l.OS_OFFERS,{keyPath:"id"}),b.createObjectStore(l.OS_CATEGORIES,{autoIncrement:!0}));c.createIndex(l.IDX_CATEGORY,l.IDX_CATEGORY,{unique:!1})},c.onsuccess=function(b){window.db=b.target.result,a()}}),o=new RSVP.Promise(function(a,b){var c="http://careers.stackoverflow.com/jobs/feed";jQuery.get(c,function(b){var c=1,d=[];jQuery(b).find("item").each(function(){var a=$(this),b=[];a.find("category").map(function(a,c){b.push($(c).text())}),d.push({id:c++,title:a.find("title").text(),link:a.find("link").text(),description:a.find("description").text(),categories:b})}),a(d)})}),p=function(c){return new RSVP.Promise(function(d,e){var f=window.db.transaction([l.OS_OFFERS,l.OS_CATEGORIES],"readonly"),g=f.objectStore(l.OS_CATEGORIES),h=g.index(l.IDX_CATEGORY),i=[],j=IDBKeyRange.only(c),m=a();h.openCursor(j).onsuccess=function(a){var c=a.target.result;if(c){var e=c.value.offer_id;m?b(k.allJobsPerId[e])&&i.push(e):i.push(e),c["continue"]()}else d(i)}})},q=function(a){var b=a.map(p);return RSVP.all(b)},r=function(a,b){return q(a).then(b)},s=function(c){function d(){return a()?b:function(a){return!0}}if(0==c.length){var e=_.filter(k.allJobsPerId,d());return _.pluck(e,"id")}return r(c,function(a){return _.intersection.apply(null,a)})},t=function(a){return r(a,function(a){return[].concat.apply([],a)})},u=function(a,b){return RSVP.hash({include:s(a),exclude:t(b)}).then(function(a){var b=_.difference(a.include,a.exclude),c=_.at(k.allJobsPerId,b),d=_.countBy(_.flatten(_.pluck(c,"categories"))),e=_.map(d,function(a,b){return{cnt:a,tag:b}}).sort(function(a,b){var c=b.cnt-a.cnt;return 0!=c?c:a.tag.localeCompare(b.tag)});return{offers:c,sortedTags:e}})};m.then(function(a){var b={database:n,feed:o};RSVP.hash(b).then(function(a){d(a.feed)}).then(function(){g()}).then(function(){$(document).on("click",".btn-filter",function(a){var b=$(this).data("tag"),c=k.filtered.indexOf(b);-1!=c?k.filtered.splice(c,1):k.filtered.push(b),g()}),$(document).on("keyup",function(a){191==a.keyCode&&$("#txt-search").focus()}),$("#txt-search").on("keyup",function(a){g()}),$(document).on("click","#chkOnlyRemote",function(){k.filtered=[],g()}),$(document).on("click","a[data-page]",function(){var a=parseInt($(this).data("page"),10)-1,b=Mustache.render(i,{offers:k.chunks[a]});$("#offers").html(b),$("ul>li.active").removeClass("active"),$(this).parent().addClass("active")}),$("#txt-search").focus()})}),window.APP=k}();